
<!DOCTYPE html>
<html lang="en">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Dev Odreystella&#39;s Blog">
    <title>Docker Compose - Dev Odreystella&#39;s Blog</title>
    <meta name="author" content="">
    
    
    
    <script type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":null,"sameAs":["https://github.com/","http://stackoverflow.com/users","https://www.linkedin.com/profile/","mailto"],"image":"profile.jpg"},"articleBody":"\n원티드 4월 백엔드 챌린지 2차 세션을 듣고 도커 컴포즈와 사용 방법에 대해 정리해보았다.2달 후, 미니프로젝트에 적용해보며 docker-compose.yml을 수정해보았다.\n\n\n\n\n\nupdated: 2024-06-26\n도커 컴포즈란?\n단일 서버에서 여러개의 컨테이너를 하나의 서비스로 정의해 컨테이너를 묶음으로 관리할 수 있는 작업 환경을 제공하는 관리 도구입니다.\nYAML 파일을 사용한다.\n\n도커 컴포즈를 사용하는 이유\n웹 애플리케이션을 만든다고 할 때 기본적으로 프론트엔드, 백엔드, 데이터베이스가 필요하다고 가정해보자. \n도커는 하나의 애플리케이션에 대해 하나의 컨테이너를 생성할 수 있는데, 도커 컴포즈를 사용하지 않는다면 프론트엔드 컨테이너, 백엔드 컨테이너, 데이터베이스 컨테이너를 각각 생성해야 한다. \n그리고 각 컨테이너를 docker run으로 실행해야한다. 매번 컨테이너를 생성하고, 실행시키는 것은 테스트 단계나, 운영단계에서 불편할 것이다.\n도커 컴포즈를 사용하게 되면 한 파일에 여러 컨테이너의 옵션과 환경을 정의할 수 있고, 복잡한 애플리케이션을 쉽게 관리할 수 있다.\n컨테이너 수가 많아지고 정의해야 할 옵션이 많아진다면 도커 컴포즈를 사용하는 것이 좋다.\n\n도커 컴포즈의 특징\n구성이 간편하다\ndocker-compose.yml 또는 compose.yml 파일 하나로 전체 애플리케이션 스택의 설정을 관리할 수 있다.\n\n\n명령어가 단순하다\ndocker compose up 커맨드로 컨테이너, 볼륨, 네트워크를 생성하고 실행한다.\ndocker compose down 커맨드로 컨테이너, 네트워크를 종료하고 제거한다.\ndocker compose ps 커맨드로 실행중인 컨테이너 목록을 확인한다.\n\n\n여러 복잡한 서비스를 관리할 수 있다.\n데이터베이스, 백엔드, 프론트엔드, 레디스 등을 한번에 관리할 수 있다. 각 서비스는 독립적인 컨테이너로 실행되지만, 도커 컴포즈를 통해 서로 연결되고 조율할 수 있다.\n\n\n각 컨테이너의 의존성, 네트워크, 볼륨 등을 정의할 수 있다.\n\nYAML 파일은 어떻게 생겼나?\n미니 프로젝트를 진행하며 구성했던 파일이다.\nDB, Django를 구성하는 파일이다.\n개발용와 운영용 두가지를 나눠서 구성했다.12345678910111213141516171819202122232425262728293031323334353637383940# 개발용 docker-compose.ymlversion: &quot;3&quot;services:  db:    container_name: mysql-dev-db  # 컨테이너 이름을 지정해준다.    image: mysql:8.4.0  # 도커 허브에서 pull 받거나 다운받은 이미지가 있으면 그걸 사용한다.    restart: always    volumes:      - dev-db-data:/var/lib/mysql    environment:      - MYSQL_ROOT_PASSWORD=$&#123;MYSQL_ROOT_PASSWORD&#125;. # .env파일에 저장한 값을 읽어온다.      - MYSQL_DATABASE=$&#123;MYSQL_DATABASE&#125;      - MYSQL_USER=$&#123;MYSQL_USER&#125;      - MYSQL_PASSWORD=$&#123;MYSQL_PASSWORD&#125;    ports:      - &quot;3306:3306&quot;  # 호스트 컴퓨터의 3306번 포트로 컨테이너 3306번 포트를 공개한다.  app:    build: .  # 해당 경로의 Dockerfile을 빌드한다.    ports:      - &quot;8000:8000&quot;    volumes:      - .:/usr/src/app    command: &gt;  # custom command로 db가 실행중인지 체크하고, migrate 후 서버를 실행한다.      sh -c &quot;python manage.py wait_for_db &amp;&amp;              python manage.py migrate &amp;&amp;              python manage.py runserver 0.0.0.0:8000&quot;    environment:      - DATABASE_NAME=$&#123;DATABASE_NAME&#125;  # django에서 settings.py의 DATABASE에서 해당 환경변수를 읽는다.      - DATABASE_USER=$&#123;DATABASE_USER&#125;      - DATABASE_PASSWORD=$&#123;DATABASE_PASSWORD&#125;      - DATABASE_HOST=$&#123;DATABASE_HOST&#125;      - DATABASE_PORT=$&#123;DATABASE_PORT&#125;    depends_on:  # db 컨테이너 생성 후, app 컨테이너를 생성한다. 실행 순서를 보장하지는 않음.      - dbvolumes:  dev-db-data:\n12# 운영용 docker-compose-deploy.yml# 곧 추가할 예정\n\n\n\nYAML 파일로 보는 주요 옵션\nversion\n도커 컴포즈 파일의 버전을 명시한다. \n도커 엔진 버전에 의존성이 있으므로 가능하면 최신 버전을 사용하는 것이 좋다.\n\n\nservices\n애플리케이션을 구성하는 컨테이너들을 정의한다. 위의 파일은 db, app 두개의 컨테이너를 정의하고 있으며, 도커 이미지, 포트 바인딩, 볼륨 마운트, 환경변수 등의 설정을 포함한다.\n\n\nnetworks\n컨테이너 간 통신을 위한 네트워크를 정의한다.\n이 항목을 정의하지 않으면 프로젝트 별로 브리지 타입의 네트워크를 생성한다.\n위 파일에서도 따로 정의하지 않았기 때문에, {프로젝트 이름_default} 브리지 타입의 네트워크를 생성해서 사용한다.\n\n\nvolumes\n데이터를 영구적으로 저장하기 위한 볼륨을 정의한다. 컨테이너가 삭제되어도 데이터를 보존하여 여러 컨테이너 간에 데이터를 공유한다. \n\n\n기타 구성 요소\nenvironment\n서비스의 컨테이너 내부에서 사용할 환경변수를 지정한다.            \nMYSQL_DATABASE=example 이나 MYSQL_DATABASE:example 포맷으로 사용한다.\ndocker run --env 이나 docker run -e 옵션과 동일하다.\n\n\ncommand\n컨테이너가 실행될 때 수행할 명령어를 설정한다.\ndocker run 명령어의 마지막에 붙는 커맨드와 같다.\n\n\ndepends_on\n특정 컨테이너에 대한 의존관계를 나타내며, 이 항목에 명시된 컨테이너가 먼저 생성되고 실행된다.\n위의 파일에서는 db &gt; app 순으로 생성되어야 한다.\n생성 순서만 보장할 뿐, db 컨테이너가 생성되고 실행중인지 확인하기 위해 체크하는 부분이 있어야 한다. 그렇지 않으면 db 컨테이너가 생성되었을 때, app에서 db 연결을 요청하고 이때 실패하면 컨테이너가 중지된다.\n\n\nports\n컨테이너는 외부환경에 노출되지 않기 때문에, 서비스의 컨테이너를 개방할 포트를 설정한다.\ndocker run -p 와 같다.\n\n\nbuild\n이 항목에 정의된 도커파일에서 이미지를 빌드해서 서비스의 컨테이너를 생성한다.\nimage 옵션을 추가해 빌드한 이미지의 이름을 설정할 수 있다.\n\n\nsecrets\nAPI 키와 비밀번호같은 민감한 정보를 설정한다.\n\n\n\n\n\n도커 컴포즈 명령어123456789101112131415# 컨테이너, 볼륨, 네트워크를 생성하고 실행한다.$ docker compose up# 컨테이너, 네트워크를 종료하고 제거한다.$ docker compose down# 컨테이너, 볼륨, 네트워크를 종료하고 제거한다.$ docker compose down -v# -f 옵션으로 도커 컴포트 파일명을 지정한다.# 기본으로 제공하는 `docker-compose.yml`이 아닌 별도의 파일명을 실행할 때 사용$ docker compose -f local-infra.yml up --build# 현재 실행중인 컨테이너 목록을 확인한다.$ docker compose ps\n\n도커 컴포즈에서 볼륨 사용 방식\n바인드 마운트 방식 1234567version: &#39;3.8&#39; services:  web:    image: nginx:latest    volumes:      - .&#x2F;host_path:&#x2F;container_path.  # 각 컨테이너 내에 경로를 직접 지정한다.\n도커 볼륨 방식12345678910version: &#39;3.8&#39;services:  web:    image: nginx:latest    volumes:      - my_volume:&#x2F;container_path  # 생성한 볼륨을 지정한다.volumes:  # 도커가 관리하는 볼륨을 생성한다.  my_volume:\n\n\n\n참고\nDockerfile reference 공식문서\n도커 컴포즈 개념 정리 및 사용법\nDocker Compose와 버전별 특징\n\n","dateCreated":"2024-04-08T11:00:18+09:00","dateModified":"2024-06-27T15:05:44+09:00","datePublished":"2024-04-08T11:00:18+09:00","description":"\n원티드 4월 백엔드 챌린지 2차 세션을 듣고 도커 컴포즈와 사용 방법에 대해 정리해보았다.2달 후, 미니프로젝트에 적용해보며 docker-compose.yml을 수정해보았다.\n","headline":"Docker Compose","image":[],"mainEntityOfPage":{"@type":"WebPage","@id":"https://odreystella.github.io/2024/04/08/Docker-compose-for-wanted-challenge/"},"publisher":{"@type":"Organization","name":null,"sameAs":["https://github.com/","http://stackoverflow.com/users","https://www.linkedin.com/profile/","mailto"],"image":"profile.jpg","logo":{"@type":"ImageObject","url":"profile.jpg"}},"url":"https://odreystella.github.io/2024/04/08/Docker-compose-for-wanted-challenge/","keywords":"원티드"}</script>
    <meta name="description" content="원티드 4월 백엔드 챌린지 2차 세션을 듣고 도커 컴포즈와 사용 방법에 대해 정리해보았다.2달 후, 미니프로젝트에 적용해보며 docker-compose.yml을 수정해보았다.">
<meta property="og:type" content="blog">
<meta property="og:title" content="Docker Compose">
<meta property="og:url" content="https://odreystella.github.io/2024/04/08/Docker-compose-for-wanted-challenge/index.html">
<meta property="og:site_name" content="Dev Odreystella&#39;s Blog">
<meta property="og:description" content="원티드 4월 백엔드 챌린지 2차 세션을 듣고 도커 컴포즈와 사용 방법에 대해 정리해보았다.2달 후, 미니프로젝트에 적용해보며 docker-compose.yml을 수정해보았다.">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2024-04-08T02:00:18.000Z">
<meta property="article:modified_time" content="2024-06-27T06:05:44.212Z">
<meta property="article:tag" content="원티드">
<meta name="twitter:card" content="summary">
    
    
        
    
    
        <meta property="og:image" content="https://odreystella.github.io/assets/images/profile.jpg"/>
    
    
    
    
    <!--STYLES-->
    
<link rel="stylesheet" href="/assets/css/style-s9cubcvh9guwrlo0a7unmtmxvwii0oase98xnhhysjkyxhquqqkxkrhfbdfm.min.css">

    <!--STYLES END-->
    

    

    
        
    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    
        
            
        
    

<header id="header" data-behavior="4">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a
            class="header-title-link"
            href="/"
            aria-label=""
        >
            Dev Odreystella&#39;s Blog
        </a>
    </div>
    
        
            <a
                class="header-right-picture "
                href="#about"
                aria-label="Open the link: /#about"
            >
        
        
            <img class="header-picture" src="/assets/images/profile.jpg" alt="Author&#39;s picture"/>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="4">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a
                    href="/#about"
                    aria-label="Read more about the author"
                >
                    <img class="sidebar-profile-picture" src="/assets/images/profile.jpg" alt="Author&#39;s picture"/>
                </a>
                <h4 class="sidebar-profile-name"></h4>
                
                    <h5 class="sidebar-profile-bio"><p>Odreystella</p>
</h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/"
                            
                            rel="noopener"
                            title="Home"
                        >
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Home</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-categories"
                            
                            rel="noopener"
                            title="Categories"
                        >
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Categories</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-tags"
                            
                            rel="noopener"
                            title="Tags"
                        >
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Tags</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-archives"
                            
                            rel="noopener"
                            title="Archives"
                        >
                        <i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Archives</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link open-algolia-search"
                            href="#search"
                            
                            rel="noopener"
                            title="Search"
                        >
                        <i class="sidebar-button-icon fa fa-search" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Search</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="#about"
                            
                            rel="noopener"
                            title="About"
                        >
                        <i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">About</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://github.com/"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="GitHub"
                        >
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="http://stackoverflow.com/users"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Stack Overflow"
                        >
                        <i class="sidebar-button-icon fab fa-stack-overflow" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Stack Overflow</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://www.linkedin.com/profile/"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="LinkedIn"
                        >
                        <i class="sidebar-button-icon fab fa-linkedin" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">LinkedIn</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/mailto"
                            
                            rel="noopener"
                            title="Mail"
                        >
                        <i class="sidebar-button-icon fa fa-envelope" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Mail</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/atom.xml"
                            
                            rel="noopener"
                            title="RSS"
                        >
                        <i class="sidebar-button-icon fa fa-rss" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">RSS</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="4"
                 class="
                        hasCoverMetaIn
                        ">
                
<article class="post">
    
    
        <div class="post-header main-content-wrap text-left">
    
        <h1 class="post-title">
            Docker Compose
        </h1>
    
    
        <div class="post-meta">
    <time datetime="2024-04-08T11:00:18+09:00">
	
		    Apr 08, 2024
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Docker/">Docker</a>


    
</div>

    
</div>

    
    <div class="post-content markdown">
        <div class="main-content-wrap">
            <blockquote>
<p>원티드 4월 백엔드 챌린지 2차 세션을 듣고 도커 컴포즈와 사용 방법에 대해 정리해보았다.<br>2달 후, 미니프로젝트에 적용해보며 docker-compose.yml을 수정해보았다.</p>
</blockquote>
<a id="more"></a>

<h1 id="table-of-contents">Table of Contents</h1><ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#%EB%8F%84%EC%BB%A4-%EC%BB%B4%ED%8F%AC%EC%A6%88%EB%9E%80"><span class="toc-text">도커 컴포즈란?</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EB%8F%84%EC%BB%A4-%EC%BB%B4%ED%8F%AC%EC%A6%88%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%98%EB%8A%94-%EC%9D%B4%EC%9C%A0"><span class="toc-text">도커 컴포즈를 사용하는 이유</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EB%8F%84%EC%BB%A4-%EC%BB%B4%ED%8F%AC%EC%A6%88%EC%9D%98-%ED%8A%B9%EC%A7%95"><span class="toc-text">도커 컴포즈의 특징</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#YAML-%ED%8C%8C%EC%9D%BC%EC%9D%80-%EC%96%B4%EB%96%BB%EA%B2%8C-%EC%83%9D%EA%B2%BC%EB%82%98"><span class="toc-text">YAML 파일은 어떻게 생겼나?</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#YAML-%ED%8C%8C%EC%9D%BC%EB%A1%9C-%EB%B3%B4%EB%8A%94-%EC%A3%BC%EC%9A%94-%EC%98%B5%EC%85%98"><span class="toc-text">YAML 파일로 보는 주요 옵션</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EB%8F%84%EC%BB%A4-%EC%BB%B4%ED%8F%AC%EC%A6%88-%EB%AA%85%EB%A0%B9%EC%96%B4"><span class="toc-text">도커 컴포즈 명령어</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EB%8F%84%EC%BB%A4-%EC%BB%B4%ED%8F%AC%EC%A6%88%EC%97%90%EC%84%9C-%EB%B3%BC%EB%A5%A8-%EC%82%AC%EC%9A%A9-%EB%B0%A9%EC%8B%9D"><span class="toc-text">도커 컴포즈에서 볼륨 사용 방식</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EC%B0%B8%EA%B3%A0"><span class="toc-text">참고</span></a></li></ol>

<p>updated: 2024-06-26</p>
<h4 id="도커-컴포즈란"><a href="#도커-컴포즈란" class="headerlink" title="도커 컴포즈란?"></a>도커 컴포즈란?</h4><ul>
<li>단일 서버에서 <strong>여러개의 컨테이너</strong>를 <strong>하나의 서비스</strong>로 정의해 컨테이너를 <strong>묶음</strong>으로 관리할 수 있는 작업 환경을 제공하는 관리 도구입니다.</li>
<li>YAML 파일을 사용한다.</li>
</ul>
<h4 id="도커-컴포즈를-사용하는-이유"><a href="#도커-컴포즈를-사용하는-이유" class="headerlink" title="도커 컴포즈를 사용하는 이유"></a>도커 컴포즈를 사용하는 이유</h4><ul>
<li>웹 애플리케이션을 만든다고 할 때 기본적으로 프론트엔드, 백엔드, 데이터베이스가 필요하다고 가정해보자. </li>
<li>도커는 하나의 애플리케이션에 대해 하나의 컨테이너를 생성할 수 있는데, 도커 컴포즈를 사용하지 않는다면 프론트엔드 컨테이너, 백엔드 컨테이너, 데이터베이스 컨테이너를 각각 생성해야 한다. </li>
<li>그리고 각 컨테이너를 <code>docker run</code>으로 실행해야한다. 매번 컨테이너를 생성하고, 실행시키는 것은 테스트 단계나, 운영단계에서 불편할 것이다.</li>
<li>도커 컴포즈를 사용하게 되면 한 파일에 여러 컨테이너의 옵션과 환경을 정의할 수 있고, 복잡한 애플리케이션을 쉽게 관리할 수 있다.</li>
<li>컨테이너 수가 많아지고 정의해야 할 옵션이 많아진다면 도커 컴포즈를 사용하는 것이 좋다.</li>
</ul>
<h4 id="도커-컴포즈의-특징"><a href="#도커-컴포즈의-특징" class="headerlink" title="도커 컴포즈의 특징"></a>도커 컴포즈의 특징</h4><ul>
<li>구성이 간편하다<ul>
<li><code>docker-compose.yml</code> 또는 <code>compose.yml</code> 파일 하나로 전체 애플리케이션 스택의 설정을 관리할 수 있다.</li>
</ul>
</li>
<li>명령어가 단순하다<ul>
<li><code>docker compose up</code> 커맨드로 컨테이너, 볼륨, 네트워크를 생성하고 실행한다.</li>
<li><code>docker compose down</code> 커맨드로 컨테이너, 네트워크를 종료하고 제거한다.</li>
<li><code>docker compose ps</code> 커맨드로 실행중인 컨테이너 목록을 확인한다.</li>
</ul>
</li>
<li>여러 복잡한 서비스를 관리할 수 있다.<ul>
<li>데이터베이스, 백엔드, 프론트엔드, 레디스 등을 한번에 관리할 수 있다. 각 서비스는 독립적인 컨테이너로 실행되지만, 도커 컴포즈를 통해 서로 연결되고 조율할 수 있다.</li>
</ul>
</li>
<li>각 컨테이너의 의존성, 네트워크, 볼륨 등을 정의할 수 있다.</li>
</ul>
<h4 id="YAML-파일은-어떻게-생겼나"><a href="#YAML-파일은-어떻게-생겼나" class="headerlink" title="YAML 파일은 어떻게 생겼나?"></a>YAML 파일은 어떻게 생겼나?</h4><ul>
<li>미니 프로젝트를 진행하며 구성했던 파일이다.</li>
<li>DB, Django를 구성하는 파일이다.</li>
<li>개발용와 운영용 두가지를 나눠서 구성했다.<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 개발용 docker-compose.yml</span></span><br><span class="line"></span><br><span class="line"><span class="attr">version:</span> <span class="string">&quot;3&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">db:</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">mysql-dev-db</span>  <span class="comment"># 컨테이너 이름을 지정해준다.</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">mysql:8.4.0</span>  <span class="comment"># 도커 허브에서 pull 받거나 다운받은 이미지가 있으면 그걸 사용한다.</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">dev-db-data:/var/lib/mysql</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MYSQL_ROOT_PASSWORD=$&#123;MYSQL_ROOT_PASSWORD&#125;.</span> <span class="comment"># .env파일에 저장한 값을 읽어온다.</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MYSQL_DATABASE=$&#123;MYSQL_DATABASE&#125;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MYSQL_USER=$&#123;MYSQL_USER&#125;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MYSQL_PASSWORD=$&#123;MYSQL_PASSWORD&#125;</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;3306:3306&quot;</span>  <span class="comment"># 호스트 컴퓨터의 3306번 포트로 컨테이너 3306번 포트를 공개한다.</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">app:</span></span><br><span class="line">    <span class="attr">build:</span> <span class="string">.</span>  <span class="comment"># 해당 경로의 Dockerfile을 빌드한다.</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;8000:8000&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">.:/usr/src/app</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">&gt;</span>  <span class="comment"># custom command로 db가 실행중인지 체크하고, migrate 후 서버를 실행한다.</span></span><br><span class="line">      <span class="string">sh</span> <span class="string">-c</span> <span class="string">&quot;python manage.py wait_for_db &amp;&amp;</span></span><br><span class="line"><span class="string">              python manage.py migrate &amp;&amp;</span></span><br><span class="line"><span class="string">              python manage.py runserver 0.0.0.0:8000&quot;</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">DATABASE_NAME=$&#123;DATABASE_NAME&#125;</span>  <span class="comment"># django에서 settings.py의 DATABASE에서 해당 환경변수를 읽는다.</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">DATABASE_USER=$&#123;DATABASE_USER&#125;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">DATABASE_PASSWORD=$&#123;DATABASE_PASSWORD&#125;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">DATABASE_HOST=$&#123;DATABASE_HOST&#125;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">DATABASE_PORT=$&#123;DATABASE_PORT&#125;</span></span><br><span class="line">    <span class="attr">depends_on:</span>  <span class="comment"># db 컨테이너 생성 후, app 컨테이너를 생성한다. 실행 순서를 보장하지는 않음.</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">db</span></span><br><span class="line"></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="attr">dev-db-data:</span></span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 운영용 docker-compose-deploy.yml</span><br><span class="line"># 곧 추가할 예정</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="YAML-파일로-보는-주요-옵션"><a href="#YAML-파일로-보는-주요-옵션" class="headerlink" title="YAML 파일로 보는 주요 옵션"></a>YAML 파일로 보는 주요 옵션</h4><ol>
<li><code>version</code><ul>
<li>도커 컴포즈 파일의 버전을 명시한다. </li>
<li>도커 엔진 버전에 의존성이 있으므로 가능하면 최신 버전을 사용하는 것이 좋다.</li>
</ul>
</li>
<li><code>services</code><ul>
<li>애플리케이션을 구성하는 컨테이너들을 정의한다. 위의 파일은 db, app 두개의 컨테이너를 정의하고 있으며, 도커 이미지, 포트 바인딩, 볼륨 마운트, 환경변수 등의 설정을 포함한다.</li>
</ul>
</li>
<li><code>networks</code><ul>
<li>컨테이너 간 통신을 위한 네트워크를 정의한다.</li>
<li>이 항목을 정의하지 않으면 프로젝트 별로 브리지 타입의 네트워크를 생성한다.</li>
<li>위 파일에서도 따로 정의하지 않았기 때문에, {프로젝트 이름_default} 브리지 타입의 네트워크를 생성해서 사용한다.</li>
</ul>
</li>
<li><code>volumes</code><ul>
<li>데이터를 영구적으로 저장하기 위한 볼륨을 정의한다. 컨테이너가 삭제되어도 데이터를 보존하여 여러 컨테이너 간에 데이터를 공유한다. </li>
</ul>
</li>
<li>기타 구성 요소<ul>
<li><code>environment</code><ul>
<li>서비스의 컨테이너 내부에서 사용할 환경변수를 지정한다.            </li>
<li><code>MYSQL_DATABASE=example</code> 이나 <code>MYSQL_DATABASE:example</code> 포맷으로 사용한다.</li>
<li><code>docker run --env</code> 이나 <code>docker run -e</code> 옵션과 동일하다.</li>
</ul>
</li>
<li><code>command</code><ul>
<li>컨테이너가 실행될 때 수행할 명령어를 설정한다.</li>
<li><code>docker run</code> 명령어의 마지막에 붙는 커맨드와 같다.</li>
</ul>
</li>
<li><code>depends_on</code><ul>
<li>특정 컨테이너에 대한 의존관계를 나타내며, 이 항목에 명시된 컨테이너가 먼저 생성되고 실행된다.</li>
<li>위의 파일에서는 db &gt; app 순으로 생성되어야 한다.</li>
<li>생성 순서만 보장할 뿐, db 컨테이너가 생성되고 실행중인지 확인하기 위해 체크하는 부분이 있어야 한다. 그렇지 않으면 db 컨테이너가 생성되었을 때, app에서 db 연결을 요청하고 이때 실패하면 컨테이너가 중지된다.</li>
</ul>
</li>
<li><code>ports</code><ul>
<li>컨테이너는 외부환경에 노출되지 않기 때문에, 서비스의 컨테이너를 개방할 포트를 설정한다.</li>
<li><code>docker run -p</code> 와 같다.</li>
</ul>
</li>
<li><code>build</code><ul>
<li>이 항목에 정의된 도커파일에서 이미지를 빌드해서 서비스의 컨테이너를 생성한다.</li>
<li><code>image</code> 옵션을 추가해 빌드한 이미지의 이름을 설정할 수 있다.</li>
</ul>
</li>
<li><code>secrets</code><ul>
<li>API 키와 비밀번호같은 민감한 정보를 설정한다.</li>
</ul>
</li>
</ul>
</li>
</ol>
<h4 id="도커-컴포즈-명령어"><a href="#도커-컴포즈-명령어" class="headerlink" title="도커 컴포즈 명령어"></a>도커 컴포즈 명령어</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 컨테이너, 볼륨, 네트워크를 생성하고 실행한다.</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> docker compose up</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 컨테이너, 네트워크를 종료하고 제거한다.</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> docker compose down</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 컨테이너, 볼륨, 네트워크를 종료하고 제거한다.</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> docker compose down -v</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> -f 옵션으로 도커 컴포트 파일명을 지정한다.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 기본으로 제공하는 `docker-compose.yml`이 아닌 별도의 파일명을 실행할 때 사용</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> docker compose -f local-infra.yml up --build</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 현재 실행중인 컨테이너 목록을 확인한다.</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> docker compose ps</span></span><br></pre></td></tr></table></figure>

<h4 id="도커-컴포즈에서-볼륨-사용-방식"><a href="#도커-컴포즈에서-볼륨-사용-방식" class="headerlink" title="도커 컴포즈에서 볼륨 사용 방식"></a>도커 컴포즈에서 볼륨 사용 방식</h4><ul>
<li>바인드 마운트 방식 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">version: &#39;3.8&#39; </span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  web:</span><br><span class="line">    image: nginx:latest</span><br><span class="line">    volumes:</span><br><span class="line">      - .&#x2F;host_path:&#x2F;container_path.  # 각 컨테이너 내에 경로를 직접 지정한다.</span><br></pre></td></tr></table></figure></li>
<li>도커 볼륨 방식<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">version: &#39;3.8&#39;</span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  web:</span><br><span class="line">    image: nginx:latest</span><br><span class="line">    volumes:</span><br><span class="line">      - my_volume:&#x2F;container_path  # 생성한 볼륨을 지정한다.</span><br><span class="line"></span><br><span class="line">volumes:  # 도커가 관리하는 볼륨을 생성한다.</span><br><span class="line">  my_volume:</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="참고"><a href="#참고" class="headerlink" title="참고"></a>참고</h4><ul>
<li><a target="_blank" rel="noopener" href="https://docs.docker.com/reference/dockerfile/">Dockerfile reference 공식문서</a></li>
<li><a target="_blank" rel="noopener" href="https://seosh817.tistory.com/387">도커 컴포즈 개념 정리 및 사용법</a></li>
<li><a target="_blank" rel="noopener" href="https://meetup.nhncloud.com/posts/277">Docker Compose와 버전별 특징</a></li>
</ul>

            


        </div>
    </div>
    <div id="post-footer" class="post-footer main-content-wrap">
        
            <div class="post-footer-tags">
                <span class="text-color-light text-small">TAGGED IN</span><br/>
                
    <a class="tag tag--primary tag--small t-none-link" href="/tags/%EC%9B%90%ED%8B%B0%EB%93%9C/" rel="tag">원티드</a>

            </div>
        
        
            <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2024/04/09/Docker-volume-for-wanted-challenge/"
                    data-tooltip="Docker Volume"
                    aria-label="PREVIOUS: Docker Volume"
                >
                    
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2024/04/07/DRF-Test-Code/"
                    data-tooltip="DRF Test Code"
                    aria-label="NEXT: DRF Test Code"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="Share this post"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://odreystella.github.io/2024/04/08/Docker-compose-for-wanted-challenge/"
                    title="Share on Facebook"
                    aria-label="Share on Facebook"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://twitter.com/intent/tweet?text=https://odreystella.github.io/2024/04/08/Docker-compose-for-wanted-challenge/"
                    title="Share on Twitter"
                    aria-label="Share on Twitter"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://plus.google.com/share?url=https://odreystella.github.io/2024/04/08/Docker-compose-for-wanted-challenge/"
                    title="Share on Google+"
                    aria-label="Share on Google+"
                >
                    <i class="fab fa-google-plus" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#table-of-contents" aria-label="Table of Contents">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


        
        
            
        
    </div>
</article>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2024 null. All Rights Reserved.
    </span>
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2024/04/09/Docker-volume-for-wanted-challenge/"
                    data-tooltip="Docker Volume"
                    aria-label="PREVIOUS: Docker Volume"
                >
                    
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                    </a>
            </li>
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2024/04/07/DRF-Test-Code/"
                    data-tooltip="DRF Test Code"
                    aria-label="NEXT: DRF Test Code"
                >
                    
                        <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="Share this post"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://odreystella.github.io/2024/04/08/Docker-compose-for-wanted-challenge/"
                    title="Share on Facebook"
                    aria-label="Share on Facebook"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://twitter.com/intent/tweet?text=https://odreystella.github.io/2024/04/08/Docker-compose-for-wanted-challenge/"
                    title="Share on Twitter"
                    aria-label="Share on Twitter"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://plus.google.com/share?url=https://odreystella.github.io/2024/04/08/Docker-compose-for-wanted-challenge/"
                    title="Share on Google+"
                    aria-label="Share on Google+"
                >
                    <i class="fab fa-google-plus" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#table-of-contents" aria-label="Table of Contents">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


                </div>
                
    <div id="share-options-bar" class="share-options-bar" data-behavior="4">
        <i id="btn-close-shareoptions" class="fa fa-times"></i>
        <ul class="share-options">
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://www.facebook.com/sharer/sharer.php?u=https://odreystella.github.io/2024/04/08/Docker-compose-for-wanted-challenge/"
                        aria-label="Share on Facebook"
                    >
                        <i class="fab fa-facebook" aria-hidden="true"></i><span>Share on Facebook</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://twitter.com/intent/tweet?text=https://odreystella.github.io/2024/04/08/Docker-compose-for-wanted-challenge/"
                        aria-label="Share on Twitter"
                    >
                        <i class="fab fa-twitter" aria-hidden="true"></i><span>Share on Twitter</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://plus.google.com/share?url=https://odreystella.github.io/2024/04/08/Docker-compose-for-wanted-challenge/"
                        aria-label="Share on Google+"
                    >
                        <i class="fab fa-google-plus" aria-hidden="true"></i><span>Share on Google+</span>
                    </a>
                </li>
            
        </ul>
    </div>


            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <img id="about-card-picture" src="/assets/images/profile.jpg" alt="Author&#39;s picture"/>
        
            <h4 id="about-card-name"></h4>
        
            <div id="about-card-bio"><p>Odreystella</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>author.job</p>

            </div>
        
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
        <!--SCRIPTS-->

<script src="/assets/js/script-buvapuslwfowfkx0w6qhxphbbnwhqezkrxx1dd6puligsitecubmpci0a9cf.min.js"></script>

<!--SCRIPTS END-->


    




    </body>
</html>
